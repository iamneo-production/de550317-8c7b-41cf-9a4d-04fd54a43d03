-- 1) HIGHEST DEBITED AMOUNT IN EACH YEAR

EXPLAIN PLAN FOR
SELECT EXTRACT(YEAR FROM "DATE") AS Year,
MAX(CAST(REGEXP_REPLACE(WITHDRAWAL_AMT, '[^0-9.]', '') AS NUMBER)) AS
HighestDebitedAmount
FROM WITHDRAW_Q
WHERE WITHDRAWAL_AMT IS NOT NULL
GROUP BY EXTRACT(YEAR FROM "DATE");
SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);


-- 2) LOWEST DEBITED AMOUNT IN EACH YEAR
EXPLAIN PLAN FOR
SELECT EXTRACT(YEAR FROM "DATE") AS Year,
MIN(CAST(REGEXP_REPLACE(WITHDRAWAL_AMT, '[^0-9.]', '') AS NUMBER)) AS
LowestDebitedAmount
FROM WITHDRAW_Q
WHERE WITHDRAWAL_AMT IS NOT NULL
GROUP BY EXTRACT(YEAR FROM "DATE");
SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);

-- 3) 5TH HIGHEST DEBITED AMOUNT IN EACH YEAR
EXPLAIN PLAN FOR
SELECT Year, FifthHighestAmount
 FROM (
SELECT
 EXTRACT(YEAR FROM "DATE") AS Year,
 CAST(REGEXP_REPLACE(WITHDRAWAL_AMT, '[^0-9.]', '') AS NUMBER) AS
FifthHighestAmount,
 DENSE_RANK() OVER (PARTITION BY EXTRACT(YEAR FROM "DATE") ORDER BY
CAST(REGEXP_REPLACE(WITHDRAWAL_AMT, '[^0-9.]', '') AS NUMBER) DESC ) AS R
FROM WITHDRAW_Q
WHERE CAST(REGEXP_REPLACE(WITHDRAWAL_AMT, '[^0-9.]', '') AS NUMBER) IS
NOT NULL
)
WHERE R = 5;
SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);


-- 4) COUNT OF WITHDRAWAL TRANSACTIONS BETWEEN MAY 5 2018 AND MARCH 7 2019

EXPLAIN PLAN FOR
SELECT COUNT(CAST(REGEXP_REPLACE(WITHDRAWAL_AMT, '[^0-9.]', '') AS
NUMBER)) AS WithdrawalCount
FROM WITHDRAW_Q
WHERE "DATE" BETWEEN TO_DATE('05-05-2018', 'DD-MM-YYYY') AND TO_DATE('07-
03-2019', 'DD-MM-YYYY');
SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);


-- 5) FIRST 5 LARGEST WITHDRAWAL TRANSACTION IN YEAR 2018
EXPLAIN PLAN FOR
SELECT DISTINCT EXTRACT(YEAR FROM "DATE") AS Year,
CAST(REGEXP_REPLACE(WITHDRAWAL_AMT, '[^0-9.]', '') AS NUMBER) AS Amount
FROM WITHDRAW_Q
WHERE EXTRACT(YEAR FROM "DATE") = 2018 AND
CAST(REGEXP_REPLACE(WITHDRAWAL_AMT, '[^0-9.]', '') AS NUMBER) IS NOT NULL
ORDER BY CAST(REGEXP_REPLACE(WITHDRAWAL_AMT, '[^0-9.]', '') AS NUMBER)
DESC FETCH FIRST 5 ROWS ONLY;
SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);